<div id="example">
    <div id="scheduler"></div>
</div>
<script id="event-template" type="text/x-kendo-template">
    <div class="movie-template" style="background-color: #=colorVal#">
      <p>#: title #</p>
      </div>
    </script>
<script id="customEditorTemplate" type="text/x-kendo-template">
    <div class="k-edit-label"><label for="recurrenceRule">Повторение</label></div>
    <div data-container-for="recurrenceRule" class="k-edit-field">
        <div data-bind="value:recurrenceRule" name="recurrenceRule" data-role="recurrenceeditor"></div>
      </div>
    <div class="k-edit-label"><label for="classId">Класс</label></div>
    <div class="k-edit-field">
              <input id="class" style="width: 60%;" data-bind="value:classId"/>
          </div>
    <div class="k-edit-label"><label for="classId">Предмет</label></div>
    <div class="k-edit-field">
                        <input id="subject" style="width: 60%;" data-bind="value:subjectId"/>
                    </div>
    <div class="k-edit-label"><label for="classId">Кабинет</label></div>
    <div class="k-edit-field">
    <input id="cabinet" style="width: 60%;" data-bind="value:cabinetId"/>
    </div>
    <div class="k-edit-label"><label for="replacement">Замена</label></div>
    <div data-container-for="Replacement" class="k-edit-field">
    <input data-bind="checked: replacement" data-type="number" type="checkbox" />
    </div>
    </script>

<script>
$(function() {
    $("#scheduler").kendoScheduler({
        footer: false,
        date: new Date("@DateTime.Now.ToString("yyyy-M-d 07:00")"),
        startTime: new Date("@DateTime.Now.ToString("yyyy-M-d 07:00")"),
        allDaySlot: false,
        majorTimeHeaderTemplate: "",
        timeSlot: false,
        ShowTimeRuler: false,
        majorTick: 1440, //set major tick to full day and leave the default startTime/endTime
        minorTickCount: 1,
        views: [
            {
                type: "day",
                selected: true,
            },
            
        ],
        editable: {
            editRecurringMode: "series",
            template: $("#customEditorTemplate").html(),
        },
        edit: function(e) {
            $("#class").kendoDropDownList({
                dataTextField: "className",
                dataValueField: "id",
                optionLabel: "Выберите класс...",
                height: 500,
                dataSource: {
                    transport: {
                        read: {
                            url: "@Url.Action("GetAllClasses","Schedule")",
                            dataType: "json",
                            cache: false
                        }
                    }
                }
            });

            $("#subject").kendoDropDownList({
                dataTextField: "subjectName",
                dataValueField: "id",
                optionLabel: "Выберите предмет...",
                height: 500,
                dataSource: {
                    transport: {
                        read: {
                            url: "@Url.Action("GetAllSubjects", "Schedule")",
                            dataType: "json",
                            cache: false
                        }
                    }
                }
            })
            $("#cabinet").kendoDropDownList({
                dataTextField: "cabinetNumber",
                dataValueField: "id",
                optionLabel: "Выберите кабинет...",
                height: 500,
                dataSource: {
                    transport: {
                        read: {
                            url: "@Url.Action("GetAllCabinets", "Schedule")",
                            dataType: "json",
                            cache: false
                        }
                    }
                }
            })
        },
        eventTemplate: $("#event-template").html(),
        timezone: "Europe/Minsk",
        dataSource: {
            batch: true,
            transport: {
                read: {
                    url: "@Url.Action("GetLessonsByTeacherId", "Schedule", new {id = ViewBag.Id})",
                    dataType: "json"
                },
                create: {
                    url: "@Url.Action("AddTeacherLessons", "Schedule")",
                    datatype: "json",
                    type: "POST"
                },
                update: {
                    url: "@Url.Action("EditTeacherLessons", "Schedule")",
                    dataType: "json",
                    type: "POST"
                },
                destroy: {
                    url: "@Url.Action("DeleteTeacherLessons", "Schedule")",
                    dataType: "json",
                    type: "DELETE"
                },
                parameterMap: function(options, operation) {
                    if (operation !== "read" && options.models) {
                        console.log(options.models[0])
                        options.models[0].dateStart = kendo.toString(options.models[0].dateStart, "dd/MM/yyyy 7:00");
                        options.models[0].dateEnd = kendo.toString(options.models[0].dateEnd, "dd/MM/yyyy 7:00");
                        return options.models[0];
                    }
                }
            },
            schema: {
                model: {
                    id: "id",
                    fields: {
                        id: {
                            from: "id",
                            type: "number"
                        },
                        title: {
                            defaultValue: "No title",
                            validation: {
                                required: true
                            }
                        },
                        start: {
                            type: "date",
                            from: "dateStart"
                        },
                        end: {
                            type: "date",
                            from: "dateEnd"
                        },
                        recurrenceRule: {
                            from: "recurrenceRule"
                        },
                        lessonNumber: {
                            from: "lessonNumber",
                        },
                        teacherId: {
                            type: "number",
                            from: "teacherId",
                            defaultValue: @ViewBag.Id
                        },
                        classId: {
                            type: "number",
                            from: "classId"
                        },
                        subjectId: {
                            type: "number",
                            from: "subjectId"
                        },
                        cabinetId: {
                            type: "number",
                            from: "cabinetId"
                        },
                        colorVal: {
                            from: "colorVal",
                        }
                    }
                }
            }
        },
        group: {
            resources: ["LessonNumber"],
            orientation: "vertical"
        },
        resources: [{
            field: "lessonNumber",
            name: "LessonNumber",
            dataSource: [{
                    text: "Урок 1",
                    value: 1
                },
                {
                    text: "Урок 2",
                    value: 2
                },
                {
                    text: "Урок 3",
                    value: 3
                },
                {
                    text: "Урок 4",
                    value: 4
                },
                {
                    text: "Урок 5",
                    value: 5
                },
                {
                    text: "Урок 6",
                    value: 6
                },
                {
                    text: "Урок 7",
                    value: 7
                },
                {
                    text: "Урок 8",
                    value: 8
                }
            ],
            title: "LessonNumber"
        }]
    });
});
</script>
<style>
    .k-icon.k-i-arrow-60-down{
        display: none;
        }
    .k-icon.k-i-arrow-60-up{
        display: none;
        }
    .k-current-time{
            display: none;
        }
    .k-event{
      		background: none;
          	border: none;
      	}
   .kendo-scheduler .k-event .k-event-actions, .k-event .k-event-actions {
   margin-right: 10px;
   }    
</style>
